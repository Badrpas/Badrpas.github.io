<!DOCTYPE html>
<html>
<head>
  <title>What's that?</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/dark.css">
  <link rel="stylesheet" href="main.css">
</head>
<body>

  <h1>Well hello there!</h1>
  <div style="margin-bottom: 10px">
    <span>I host some of my projects here</span>
  </div>

  <div id="project-list">

  </div>

  <div id="entry-template">
    <a class="entry" href="{{href}}" target="_blank">
      <span>{{description}}</span>
    </a>
  </div>

  <script>
    fetch('links.jsonasdasd')
      .then(r => r.json())
      .then(entries => entries.forEach(renderEntry))
      .catch(err => {
        console.error(err);
        // language=HTML
        renderHtml(`
          <code>Couldn't load project list :(</code>
        `);
      });

    const templateEl = document.getElementById('entry-template');
    const templateRaw = templateEl.innerHTML;

    const template = createTemplate(templateRaw);

    function renderEntry (entry) {
      const html = template({
        href: entry.dir,
        description: entry.repo?.description || entry.description || entry.dir,
      });

      renderHtml(html, document.getElementById('project-list'));
    }

    function createTemplate (src) {
      return (arg = {}) => {
        return Object.entries(arg).reduce((out, [key, value]) => {
          return out.replace(new RegExp(`{{${key}}}`, 'g'), value);
        }, src);
      };
    }
    function renderHtml (html, containerEl = document.body) {
      const tempEl = document.createElement('div');
      tempEl.innerHTML = html;

      containerEl.append(...tempEl.children);
    }
  </script>

</body>
</html>
